ğŸ§¾ **Objetivo general**
Necesito que modifiques mi sistema de checkout en Archub para agregar una nueva opciÃ³n de pago: **Transferencia bancaria con descuento automÃ¡tico**.

Ya tengo funcionando:
- Mercado Pago (para Argentina)
- PayPal (para exterior)
Ambos funcionan bien.

El nuevo mÃ©todo de **transferencia bancaria** debe:
1. Aplicar automÃ¡ticamente un **5% de descuento** sobre el total (por evitar comisiones).
2. Ser combinable con otros descuentos existentes (por ejemplo, descuento de estudiante o cupÃ³n promocional).
3. Mostrarlo de forma clara en el frontend, en el resumen de pago y en la UI de selecciÃ³n de mÃ©todo.
4. Generar un registro en la base de datos (`payments`) con `payment_method = 'transferencia'` y `status = 'pending_transfer'`.
5. Mostrar un alias o CBU donde el usuario debe transferir y un texto tipo â€œTu inscripciÃ³n quedarÃ¡ activa cuando recibamos tu comprobanteâ€.

---

ğŸ§± **1. LÃ³gica de descuentos combinables**

Estructura base de cÃ¡lculo (usa tu misma lÃ³gica de precios):

```ts
precio_final = precio_base
  * (1 - student_discount)
  * (1 - coupon_discount)
  * (1 - bank_transfer_discount)
```

El `bank_transfer_discount` debe aplicarse **solo** si el mÃ©todo de pago elegido es â€œTransferencia bancariaâ€.

Valor por defecto:  
```js
const bank_transfer_discount = 0.05; // 5%
```

---

ğŸ¨ **2. Cambios en el frontend (componente de checkout)**

Agregar un nuevo botÃ³n o card en la selecciÃ³n de mÃ©todos de pago:

```
MÃ©todo de pago:
[â€¢] Tarjeta / Mercado Pago
[â€¢] PayPal (USD)
[â€¢] Transferencia bancaria ğŸ’¸ -5% adicional
```

Cuando el usuario elige â€œTransferencia bancariaâ€:
- Se recalcula el total aplicando el descuento del 5%.
- Se actualiza el resumen del lado derecho mostrando:

```
Subtotal:                 $100.000
Descuento estudiante:     -$10.000
Descuento transferencia:  -$4.500
TOTAL A PAGAR:            $85.500
```

- Y aparece un bloque de confirmaciÃ³n con la info de transferencia:

```
Alias: ARCHUB.PAGOS
CBU: 0000003100088888888888
Banco: Santander RÃ­o
Titular: ARCHUB SRL

ğŸ“„ Tu inscripciÃ³n quedarÃ¡ activa cuando confirmemos el pago.
Por favor, enviÃ¡ el comprobante a cursos@archub.com o sÃºbilo desde tu perfil.
```

(UsÃ¡ datos ficticios, los reemplazo luego.)

---

ğŸ§® **3. ActualizaciÃ³n de la base de datos (Supabase)**

Agregar campos si aÃºn no existen en la tabla `payments`:

```sql
ALTER TABLE payments
ADD COLUMN IF NOT EXISTS payment_method text CHECK (payment_method IN ('mercadopago', 'paypal', 'transferencia')),
ADD COLUMN IF NOT EXISTS discount_transfer numeric DEFAULT 0.05;
```

Cuando se genera el pago con transferencia:
- Insertar fila en `payments` con:
  ```js
  {
    user_id,
    course_id,
    payment_method: 'transferencia',
    amount: precio_final,
    discount_transfer: 0.05,
    status: 'pending_transfer'
  }
  ```

---

ğŸª„ **4. LÃ³gica de confirmaciÃ³n**

DespuÃ©s de confirmar el pago, el usuario debe ver una pantalla de Ã©xito tipo:

```
âœ… Pago por transferencia iniciado
Te enviamos los datos para realizar la transferencia.
Tu curso se activarÃ¡ automÃ¡ticamente una vez validado el pago.
```

El backend no procesa nada con Mercado Pago ni PayPal en este caso, solo guarda el registro y muestra las instrucciones.

---

ğŸ¯ **5. Bonus (opcional)**
Si el usuario tiene tanto descuento de estudiante como de transferencia, deben **sumarse de forma multiplicativa**, no acumulativa.

Ejemplo:
Curso $100.000  
Estudiante 10 % â†’ $90.000  
Transferencia 5 % â†’ $85.500

---

ğŸ”’ **6. Seguridad**
El backend debe validar que solo usuarios autenticados puedan generar pagos por transferencia.
El estado `pending_transfer` podrÃ¡ actualizarse manualmente desde el panel administrativo cuando se confirme el pago.

---

âœ… **Resumen final**
- Agregar botÃ³n â€œTransferencia bancariaâ€ al checkout.
- Aplicar descuento automÃ¡tico del 5%.
- Mostrarlo en resumen de totales.
- Insertar registro `payments` con `payment_method='transferencia'` y `status='pending_transfer'`.
- Mostrar datos bancarios e instrucciones.
- Mantener PayPal y Mercado Pago sin cambios.

UsÃ¡ el mismo estilo visual que el resto del checkout (botones compactos, modo dark, etc.) y asegurate de que todo funcione correctamente tambiÃ©n en mobile.
