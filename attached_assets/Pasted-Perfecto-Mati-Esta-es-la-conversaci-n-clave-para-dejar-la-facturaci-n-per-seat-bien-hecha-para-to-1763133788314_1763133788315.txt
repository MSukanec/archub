Perfecto Mati.
Esta es la conversaciÃ³n clave para dejar la facturaciÃ³n â€œper seatâ€ bien hecha para toda la vida del proyecto.
Vamos paso a paso, desde la arquitectura de tus tablas actuales, y te digo quÃ© estÃ¡ bien, quÃ© falta, y cÃ³mo se integra exactamente el tema de los usuarios billables / seats.

âœ… 1) Lo que ya tenÃ©s estÃ¡ PERFECTO

Vos hoy tenÃ©s:

1. Cuando alguien compra un plan

Se crea/actualiza el plan de la organizaciÃ³n (en organizations.plan_id)

Se registra una fila en organization_subscriptions
con:

organization_id

plan_id

status

perÃ­odo

renewal_at

amount

currency

transaction_id (PayPal / MP)

etc.

ğŸ‘‰ Esto estÃ¡ bien. Es EXACTAMENTE como lo hacen Stripe, Paddle, Lemon Squeezy, SaaS Procore, Notion, etc.

NO hay que cambiar eso.

ğŸ§  2) Pero esa parte solo cubre la compra del PLAN

El Plan PRO es precio fijo (monthly).

El Plan TEAMS es per-user (per-seat billing).

La compra del plan no sabe CUÃNTOS seats hay.
Solo sabe la base del plan:

PRO â†’ 1 precio fijo mensual

TEAMS â†’ precio â€œpor usuario activoâ€

Entonces:

ğŸ”´ Algo falta entre tus tablas actuales.
Lo que falta es la tabla que determina cuÃ¡ntos seats se van a facturar mes a mes.

Y esa tabla NO es organization_subscriptions.

ğŸ”¥ 3) En un sistema profesional, los seats NO estÃ¡n en organization_subscriptions

Los seats se determinan POR ORGANIZACIÃ“N segÃºn los miembros activos.

Por eso la tabla correcta para trackear seats NO es organization_subscriptions.

La tabla correcta ya la tenÃ©s:
ğŸ‘‰ organization_members

Pero le faltaba algo:
ğŸ‘‰ is_billable

Con eso, cada miembro es:

billable seat

non-billable seat (dueÃ±os, invitados, free seats, etc.)

Esto lo hace Slack, Notion, ClickUp, Miro, Figma, Asana, etc.

âœ” 4) Entonces, la arquitectura ideal que vos YA TENÃ‰S con un pequeÃ±o ajuste es:
A) organizations.plan_id

â†’ define si el plan es Free, Pro o Teams.

B) organization_subscriptions

â†’ trackea cada ciclo de facturaciÃ³n.
â†’ SOLO el plan, fechas, pagos, etc.
â†’ NO trackea seats.

C) organization_members

â†’ contiene los seats reales.
â†’ cada miembro = un seat potencial
â†’ is_billable = true = seat facturable
â†’ is_billable = false = seat no facturable (regalo tuyo)

ğŸ§© 5) La tabla que te falta (si querÃ©s hacerlo PERFECTO)

No necesitÃ¡s otra tabla obligatoriamente, pero si querÃ©s facturaciÃ³n muy limpia te recomiendo agregar:

ğŸ“Œ organization_billing_cycles

Una tabla que guarda el resultado del cÃ¡lculo mensual:

create table organization_billing_cycles (
  id uuid primary key default gen_random_uuid(),
  organization_id uuid not null references organizations(id),
  plan_id uuid not null references plans(id),
  seats integer not null,
  amount_per_seat numeric not null,
  total_amount numeric not null,
  period_start timestamptz not null,
  period_end timestamptz not null,
  paid boolean default false,
  payment_provider text,
  payment_id text,
  created_at timestamptz default now()
);

Â¿Por quÃ© sirve?

Deja â€œregistradoâ€ cuÃ¡ntos seats tuvo la organizaciÃ³n ese mes.

Permite auditorÃ­a.

Permite reintentos de cobro.

Permite facturaciÃ³n pro-rata si agregan seats a mitad de mes.

Permite informes histÃ³ricos.

Pero se puede vivir sin esto (al principio).

ğŸ§  6) Â¿DÃ³nde encaja el momento de invitar nuevos usuarios?

Cuando alguien invita un usuario a su organizaciÃ³n:

Se crea una fila en organization_members

El campo is_billable determina si ese usuario es un â€œseatâ€ facturable o no.

Nada mÃ¡s.

Eso es TODO lo que se necesita para que la facturaciÃ³n mensual funcione.

ğŸ” 7) Â¿CuÃ¡ndo se calcula la facturaciÃ³n real?
â†’ Al inicio (o fin) de cada ciclo mensual:
seats_facturables = count(*) from organization_members
                    where organization_id = X
                    and is_billable = true
                    and status = 'active'


Y entonces:

total_mensual = seats_facturables * price_per_seat


Si plan PRO â†’ 0 seats, es precio fijo.
Si plan Teams â†’ variable segÃºn seats.

ğŸ¯ 8) Respondiendo exacto a tu pregunta: â€œÂ¿DÃ³nde entra el tema de invitar usuarios mÃ¡s?â€
ENTRA ÃšNICAMENTE a travÃ©s de:
organization_members.is_billable


Y nada mÃ¡s.

No afecta:

organization_subscriptions

users

plans

projects

etc.

El cÃ¡lculo mensual usa solamente esta tabla.

ğŸ“Œ 9) Â¿QuÃ© tablas deberÃ­as tener para que todo funcione perfecto?
â­ Ya tenÃ©s:

organizations

organization_members

plans

organization_subscriptions

users

â­ Te faltaba:

organization_members.is_billable (ya agregado âœ”)

â­ Opcional (recomendado para escalar):

organization_billing_cycles
(para registrar cada facturaciÃ³n mensual)