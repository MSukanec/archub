## üéØ Objetivo

Corregir la funcionalidad de subida de archivos en el modal de bit√°cora. Actualmente da error `400 Bad Request` al subir im√°genes al bucket `site-log-files` de Supabase.

---

## ‚ùóÔ∏èProblema actual

Se est√° intentando subir un archivo a Supabase Storage y el servidor responde con error:

Failed to load resource: the server responded with a status of 400

yaml
Copiar
Editar

Esto normalmente significa que:
- El archivo ya existe y `upsert` no est√° activado.
- El nombre (`filePath`) no cumple las reglas RLS activas.
- El objeto `file` es inv√°lido o est√° vac√≠o.
- O bien la subida est√° mal estructurada.

---

## ‚úÖ Qu√© debe hacer el c√≥digo

### 1. Generar nombre √∫nico para el archivo

```ts
const extension = file.name.split('.').pop();
const filePath = `${crypto.randomUUID()}.${extension}`;
2. Subir a Supabase Storage (con upsert: true)
ts
Copiar
Editar
const { error: uploadError } = await supabase.storage
  .from('site-log-files')
  .upload(filePath, file, {
    upsert: true,
  });

if (uploadError) {
  console.error("Error al subir archivo", uploadError);
  return;
}
3. Insertar el registro en la tabla site_log_files
ts
Copiar
Editar
const { data: publicUrlData } = supabase
  .storage
  .from('site-log-files')
  .getPublicUrl(filePath);

await supabase.from('site_log_files').insert({
  file_path: filePath,
  file_name: file.name,
  file_type: file.type,
  file_url: publicUrlData?.publicUrl,
  site_log_id,          // ID del d√≠a de bit√°cora
  user_id,              // Usuario actual
  organization_id,      // Organizaci√≥n actual
  visibility: 'organization' // o 'private'
});
‚úÖ Validaciones necesarias
Antes de subir:

ts
Copiar
Editar
if (!file || file.size === 0) {
  console.error("Archivo vac√≠o o inv√°lido");
  return;
}
Y loguear:

ts
Copiar
Editar
console.log("Subiendo archivo:", filePath, file);
Resultado esperado
Los archivos se suben correctamente sin error 400.

La ruta filePath coincide con lo que se guarda en la tabla site_log_files.

Se respeta la seguridad definida por las RLS.

La visibilidad est√° controlada desde la tabla, no desde el nombre del archivo.