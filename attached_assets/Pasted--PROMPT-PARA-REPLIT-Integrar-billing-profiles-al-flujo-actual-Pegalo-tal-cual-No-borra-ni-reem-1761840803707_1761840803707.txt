üß© PROMPT PARA REPLIT ‚Äî Integrar billing_profiles al flujo actual

Pegalo tal cual. No borra ni reemplaza nada, solo agrega la l√≥gica de guardado opcional de facturaci√≥n.

Quiero que actualices la l√≥gica del checkout (p√°gina o handlers donde se inicia el pago con Mercado Pago, PayPal o transferencia) para que, si el usuario complet√≥ el bloque ‚ÄúNecesito factura‚Äù, guardes esos datos en la tabla billing_profiles de Supabase antes de crear el pago.
No cambies los nombres ni endpoints existentes (/api/mp/create_preference, /api/paypal/create-order, etc.); solo insert√° esta acci√≥n previa.

Reglas

Tabla destino: public.billing_profiles (ya creada).

Campos a escribir:

{
  user_id: <auth.uid()>,
  is_company: billing.is_company,
  full_name: billing.billing_full_name || null,
  company_name: billing.company_name || null,
  tax_id: billing.tax_id || null,
  country_id: billing.billing_country_id || null,
  address_line1: billing.billing_address_line1 || null,
  city: billing.billing_city || null,
  postcode: billing.billing_postcode || null,
}


Si el usuario ya ten√≠a un perfil, usar upsert (update si existe user_id, insert si no).

Si no hay datos de facturaci√≥n (acorde√≥n cerrado o campos vac√≠os), no hagas nada.

No interrumpas el flujo de pago si el insert falla (solo logue√° el error en consola).

Llamar esta l√≥gica antes de crear la preferencia u orden de pago.

Ejemplo (pseudoc√≥digo para entender la secuencia)
if (billing && hasAnyValue(billing)) {
  try {
    await supabase.from('billing_profiles').upsert({
      user_id: user.id,
      is_company: billing.is_company,
      full_name: billing.billing_full_name || null,
      company_name: billing.company_name || null,
      tax_id: billing.tax_id || null,
      country_id: billing.billing_country_id || null,
      address_line1: billing.billing_address_line1 || null,
      city: billing.billing_city || null,
      postcode: billing.billing_postcode || null
    });
  } catch (e) {
    console.error('[billing_profiles] error', e);
  }
}

// Luego seguir normalmente:
if (selectedPayment === 'mercadopago') iniciarMP();
if (selectedPayment === 'paypal') iniciarPayPal();

QA esperado

Si el usuario no abre el acorde√≥n ‚Üí no se guarda nada.

Si lo abre y completa datos ‚Üí se crea o actualiza su fila en billing_profiles.

Si vuelve a comprar ‚Üí se actualiza autom√°ticamente (no duplica).

Si hay error en el insert ‚Üí igual se inicia el pago (no rompe el flujo).