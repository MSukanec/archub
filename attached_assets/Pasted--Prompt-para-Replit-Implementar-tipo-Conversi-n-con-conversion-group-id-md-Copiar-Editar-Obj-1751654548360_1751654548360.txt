✅ Prompt para Replit – Implementar tipo “Conversión” con conversion_group_id
md
Copiar
Editar
## Objetivo

Agregar soporte completo para el tipo de movimiento "Conversión" en la tabla `movements`. Esto implica modificar tanto la lógica del modal como el comportamiento de inserción y eliminación en Supabase.

---

## Contexto

Ya se agregó en Supabase la columna `conversion_group_id` en la tabla `movements` (tipo UUID).

Cuando un usuario selecciona "Conversión" en el campo "Tipo" del modal, se debe crear **dos movimientos diferentes** (un egreso en una moneda y un ingreso en otra), **vinculados por el mismo `conversion_group_id`**.

---

## Qué debe hacer el código

### 1. En el modal de creación de movimiento:

Si el usuario selecciona el tipo `"Conversión"`:

#### Mostrar dos bloques:

**A. Movimiento de salida (egreso)**:
- Billetera origen
- Moneda origen
- Monto entregado

**B. Movimiento de entrada (ingreso)**:
- Billetera destino
- Moneda destino
- Monto recibido

(Esto puede mostrarse como un acordeón expandido o un bloque de dos columnas.)

#### Opcional:
- Mostrar tipo de cambio calculado (ej: `657000 / 500 = 1314.00`)
- Validar que ambas monedas sean distintas

---

### 2. Al guardar:

1. Generar un nuevo `UUID` para `conversion_group_id`.
2. Crear **dos movimientos** con `insert()`:

#### Movimiento 1 (egreso)
```ts
{
  type: 'egreso',
  amount: monto_origen,
  currency_id: moneda_origen,
  wallet_id: billetera_origen,
  conversion_group_id: groupId,
  ...otros datos
}
Movimiento 2 (ingreso)
ts
Copiar
Editar
{
  type: 'ingreso',
  amount: monto_destino,
  currency_id: moneda_destino,
  wallet_id: billetera_destino,
  conversion_group_id: groupId,
  ...otros datos
}
Ambos deben insertarse como parte del mismo mutationFn para evitar inconsistencias.

3. Al eliminar un movimiento que tenga conversion_group_id:
Antes de borrar, hacer:

ts
Copiar
Editar
await supabase
  .from('movements')
  .delete()
  .eq('conversion_group_id', groupId);
Esto asegura que se eliminen las dos filas relacionadas con la conversión.

Resultado esperado
El usuario puede registrar conversiones entre divisas desde el modal.

Se crean dos movimientos correctos, vinculados.

La UI muestra las conversiones como filas agrupadas.

Al eliminar una conversión, se eliminan ambas partes.

Bonus visual (opcional)
En la tabla de movimientos, si conversion_group_id no es null, mostrar ese movimiento como:

"Conversión USD → ARS"
Y agrupar ambas filas visualmente si están consecutivas.