ğŸ¯ Objetivo: mostrarle al usuario el Ãºltimo historial de IA cuando entra al Home (/dashboard).

ğŸ”§ Archivos a modificar:
1. src/components/pages/Dashboard/HomeAssistant.tsx
2. src/hooks/useIaChat.ts
3. src/pages/Dashboard/Home.tsx (si hace falta)

ğŸ“¦ Paso a paso:

âœ… 1. Crear nuevo endpoint: `/api/ai/get-history.ts`

Este endpoint recibirÃ¡ el `context_type` y devolverÃ¡ los Ãºltimos 20 mensajes de `ia_messages` del usuario autenticado.

```ts
// /api/ai/get-history.ts
import { supabaseAdmin } from "@/lib/supabaseAdmin"; // o crear client con service_role si usÃ¡s Vercel
import { getUserFromRequest } from "@/lib/auth";

export default async function handler(req, res) {
  const user = await getUserFromRequest(req);
  if (!user) return res.status(401).json({ error: "Unauthorized" });

  const { context_type = "home_chat" } = req.query;

  const { data, error } = await supabaseAdmin
    .from("ia_messages")
    .select("role, content, created_at")
    .eq("user_id", user.id)
    .eq("context_type", context_type)
    .order("created_at", { ascending: true })
    .limit(20);

  if (error) return res.status(500).json({ error: error.message });

  res.json({ messages: data });
}
âœ… 2. En useIaChat.ts, agregar funciÃ³n loadHistory()

ts
Copiar cÃ³digo
const loadHistory = async () => {
  try {
    const res = await fetch("/api/ai/get-history?context_type=home_chat");
    const json = await res.json();
    if (json.messages) {
      setMessages(json.messages); // inicializar el chat con los mensajes guardados
    }
  } catch (error) {
    console.error("Error loading history:", error);
  }
};
âœ… 3. En el useEffect de HomeAssistant.tsx, cargar el historial al montar

ts
Copiar cÃ³digo
useEffect(() => {
  loadHistory();
}, []);
âœ… 4. (Opcional) Mostrar un loader de historial mientras carga

tsx
Copiar cÃ³digo
if (isLoadingHistory) return <Spinner />; // o cualquier loader
ğŸ“Œ Bonus:

LimitÃ¡ a 20 o 50 mensajes si querÃ©s mantenerlo liviano.

En el futuro podÃ©s paginar si querÃ©s historial infinito.

âœ… Resultado
Cada vez que el usuario entra al Home de IA:

Se cargan los Ãºltimos mensajes automÃ¡ticamente desde Supabase.

Puede continuar la conversaciÃ³n donde la dejÃ³.

Esto da sensaciÃ³n de "IA continua", no solo un chatbot en el momento.