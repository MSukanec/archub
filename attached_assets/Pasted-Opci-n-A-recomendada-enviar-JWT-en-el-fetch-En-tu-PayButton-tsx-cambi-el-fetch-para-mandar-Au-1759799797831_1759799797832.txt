Opción A (recomendada): enviar JWT en el fetch

En tu PayButton.tsx cambiá el fetch para mandar:

Authorization: Bearer <token> (el access token del usuario si está logueado, o al menos el anon key)

apikey: <anon key> (es pública)

Ejemplo con supabase-js ya inicializado en tu app:

import { supabase } from '@/lib/supabaseClient'; // o donde lo tengas

async function handlePay() {
  try {
    setLoading(true);

    // 1) Tomo el token del usuario logueado (si hay sesión)
    const { data: { session } } = await supabase.auth.getSession();
    const userToken = session?.access_token;

    // 2) Tu anon key (segura para front). Guardala en env del front: VITE_SUPABASE_ANON_KEY / NEXT_PUBLIC_SUPABASE_ANON_KEY
    const anonKey = import.meta.env.VITE_SUPABASE_ANON_KEY; // o process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

    const r = await fetch('https://wtatvsgeivymcppowrfy.functions.supabase.co/create_mp_preference', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // Enviá SIEMPRE apikey, y Authorization con el token de usuario si existe;
        // si no hay usuario, mandá el anonKey:
        'apikey': anonKey,
        'Authorization': `Bearer ${userToken || anonKey}`,
      },
      body: JSON.stringify({
        user_id: currentUser.id,        // el id real
        course_slug: course.slug,       // el slug real
        price: 1000,
        currency: 'ARS',
        months: null
      })
    });

    const data = await r.json();
    if (!r.ok) throw new Error(data?.error || 'No se pudo crear la preferencia');
    const url = data.sandbox_init_point || data.init_point;
    if (!url) throw new Error('Preferencia sin URL');
    window.location.href = url;

  } catch (err:any) {
    console.error(err);
    setError(err.message || 'Error al iniciar pago');
  } finally {
    setLoading(false);
  }
}


Tip: asegurate de tener tu anon key disponible en el front (Replit/ENV) como VITE_SUPABASE_ANON_KEY o NEXT_PUBLIC_SUPABASE_ANON_KEY.