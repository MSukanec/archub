declare
  org_id uuid := gen_random_uuid();
  now_timestamp timestamp with time zone := now();

  -- Roles, IDs y valores por defecto
  plan_free_id uuid := '015d8a97-6b6e-4aec-87df-5d1e6b0e4ed2';
  admin_role_id uuid := '81be9c24-1e85-4f48-a131-2c618e0d1888';
  default_currency_id uuid := '58c50aa7-b8b1-4035-b509-58028dd0e33f';
  default_wallet_id uuid := '2658c575-0fa8-4cf6-85d7-6430ded7e188';
  default_pdf_template_id uuid := 'b6266a04-9b03-4f3a-af2d-f6ee6d0a948b';

begin
  -- Paso 1: Crear la organizaci√≥n
  insert into public.organizations (
    id, name, created_by, created_at, updated_at, is_active, plan_id
  ) values (
    org_id, _organization_name, _user_id, now_timestamp, now_timestamp, true, plan_free_id
  );

  -- Paso 2: Datos adicionales (opcional)
  insert into public.organization_data (organization_id)
  values (org_id);

  -- Paso 3: Miembro admin
  insert into public.organization_members (
    id, user_id, organization_id, role_id, is_active, created_at, joined_at, last_active_at
  ) values (
    gen_random_uuid(), _user_id, org_id, admin_role_id, true, now_timestamp, now_timestamp, now_timestamp
  );

  -- Paso 4: Moneda y billetera por defecto
  insert into public.organization_currencies (
    id, organization_id, currency_id, is_active, is_default, created_at
  ) values (
    gen_random_uuid(), org_id, default_currency_id, true, true, now_timestamp
  );

  insert into public.organization_wallets (
    id, organization_id, wallet_id, is_active, is_default, created_at
  ) values (
    gen_random_uuid(), org_id, default_wallet_id, true, true, now_timestamp
  );

  -- Paso 5: Preferencias por defecto
  insert into public.organization_preferences (
    organization_id, default_currency_id, default_wallet_id, default_pdf_template_id, created_at, updated_at
  ) values (
    org_id, default_currency_id, default_wallet_id, default_pdf_template_id, now_timestamp, now_timestamp
  );

  -- Paso 6: Crear fila en user_organization_preferences
  insert into public.user_organization_preferences (
    id, user_id, organization_id, last_project_id, created_at, updated_at
  ) values (
    gen_random_uuid(), _user_id, org_id, NULL, now_timestamp, now_timestamp
  );

  return org_id;
end;